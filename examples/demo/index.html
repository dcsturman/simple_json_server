<!DOCTYPE html>
<!--
========================================
üöÄ LOOKING FOR THE JAVASCRIPT CODE?
========================================
Skip to line ~180 for the main JavaScript that shows how to call
Rust actor methods from a web browser!

The JavaScript demonstrates:
- Making HTTP POST requests to Rust actor endpoints
- Handling JSON request/response data
- Error handling and CORS
- Calling methods with and without parameters
========================================
-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple JSON Server Demo</title>
    <!--
    ========================================
    üé® CSS STYLES (skip to line ~160 for JavaScript)
    ========================================
    -->
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .method-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #fafafa;
        }
        .method-title {
            font-size: 18px;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        .method-description {
            color: #666;
            margin-bottom: 15px;
        }
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin: 5px 0;
        }
        button {
            background-color: #3498db;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px 0;
        }
        button:hover {
            background-color: #2980b9;
        }
        .result {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .api-docs {
            background-color: #e8f4f8;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .status {
            text-align: center;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .status.online {
            background-color: #d4edda;
            color: #155724;
        }
        .status.offline {
            background-color: #f8d7da;
            color: #721c24;
        }
    </style>
    <!--
    ========================================
    üé® END OF CSS STYLES
    ========================================
    -->
</head>
<body>
    <!--
    ========================================
    üìÑ HTML CONTENT (skip to line ~170 for JavaScript)
    ========================================
    -->
    <div class="container">
        <h1>ü¶Ä Simple JSON Server Demo</h1>
        
        <div class="api-docs">
            <h3>üìö API Documentation</h3>
            <p>This page demonstrates the JSON-RPC interface generated by the Rust <code>#[actor]</code> macro.</p>
            <p><strong>Server:</strong> <code>http://127.0.0.1:9000</code></p>
            <p><strong>Protocol:</strong> HTTP POST with JSON payloads</p>
        </div>

        <div id="status" class="status offline">
            üîç Checking server status...
        </div>

        <div class="method-section">
            <div class="method-title">üìã get_id()</div>
            <div class="method-description">
                Get the current ID of this actor instance. Takes no parameters.
            </div>
            <button onclick="callGetId()">Call get_id()</button>
            <div id="getId-result" class="result" style="display: none;"></div>
        </div>

        <div class="method-section">
            <div class="method-title">üëã greet(name: String)</div>
            <div class="method-description">
                Greet someone with a personalized message. Requires a name parameter.
            </div>
            <input type="text" id="greet-name" placeholder="Enter your name" value="Web User">
            <button onclick="callGreet()">Call greet()</button>
            <div id="greet-result" class="result" style="display: none;"></div>
        </div>

        <div class="method-section">
            <div class="method-title">‚ùå Test Invalid Method</div>
            <div class="method-description">
                Test calling a non-existent method to see error handling.
            </div>
            <button onclick="callInvalidMethod()">Call invalid_method()</button>
            <div id="invalid-result" class="result" style="display: none;"></div>
        </div>

        <div class="api-docs">
            <h3>üîß Manual Testing</h3>
            <p>You can also test the API manually with curl:</p>
            <pre><code># Get ID
curl -X POST http://127.0.0.1:9000/get_id -d '{}'

# Greet
curl -X POST http://127.0.0.1:9000/greet -d '{"name": "World"}'</code></pre>
        </div>
    </div>

    <!--
    ========================================
    üöÄ JAVASCRIPT CODE STARTS HERE!
    ========================================
    This is the main JavaScript that demonstrates how to call
    the Rust actor methods from a web browser.
    ========================================
    -->
    <script>
        // ========================================
        // üîß CONFIGURATION
        // ========================================
        const SERVER_URL = 'http://127.0.0.1:9000';

        // ========================================
        // üöÄ MAIN ENTRY POINT
        // ========================================
        // Check server status on page load
        window.addEventListener('load', checkServerStatus);

        async function checkServerStatus() {
            const statusDiv = document.getElementById('status');
            try {
                const response = await fetch(`${SERVER_URL}/get_id`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: '{}'
                });
                
                if (response.ok) {
                    statusDiv.className = 'status online';
                    statusDiv.textContent = '‚úÖ Server is online and responding';
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusDiv.className = 'status offline';
                statusDiv.textContent = '‚ùå Server is offline. Please start the server with: cargo run';
            }
        }

        // ========================================
        // üåê HTTP REQUEST FUNCTIONS
        // ========================================
        // This function shows how to call Rust actor methods via HTTP POST
        async function callMethod(method, params = {}) {
            try {
                const response = await fetch(`${SERVER_URL}/${method}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(params)
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                return { success: true, result };
            } catch (error) {
                return { success: false, error: error.message };
            }
        }

        function displayResult(elementId, response) {
            const resultDiv = document.getElementById(elementId);
            resultDiv.style.display = 'block';
            
            if (response.success) {
                resultDiv.className = 'result success';
                resultDiv.textContent = `‚úÖ Success: ${JSON.stringify(response.result, null, 2)}`;
            } else {
                resultDiv.className = 'result error';
                resultDiv.textContent = `‚ùå Error: ${response.error}`;
            }
        }

        // ========================================
        // üéØ SPECIFIC API METHOD CALLS
        // ========================================
        // These functions demonstrate calling each Rust actor method

        // Call the get_id() method (no parameters)
        async function callGetId() {
            const response = await callMethod('get_id');
            displayResult('getId-result', response);
        }

        // Call the greet(name: String) method (with parameter)
        async function callGreet() {
            const name = document.getElementById('greet-name').value;
            if (!name.trim()) {
                displayResult('greet-result', { 
                    success: false, 
                    error: 'Please enter a name' 
                });
                return;
            }
            
            const response = await callMethod('greet', { name });
            displayResult('greet-result', response);
        }

        // Call an invalid method to test error handling
        async function callInvalidMethod() {
            const response = await callMethod('invalid_method');
            displayResult('invalid-result', response);
        }
    </script>
</body>
</html>
